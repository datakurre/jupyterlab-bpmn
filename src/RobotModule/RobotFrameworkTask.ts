import { is } from 'bpmn-js/lib/util/ModelUtil';
import BaseRenderer from 'diagram-js/lib/draw/BaseRenderer';
import inherits from 'inherits/inherits_browser';
import { append as svgAppend, create as svgCreate } from 'tiny-svg';

const Robot =
  'data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiIHN0YW5kYWxvbmU9Im5vIj8+CjxzdmcKICAgeG1sbnM6ZGM9Imh0dHA6Ly9wdXJsLm9yZy9kYy9lbGVtZW50cy8xLjEvIgogICB4bWxuczpjYz0iaHR0cDovL2NyZWF0aXZlY29tbW9ucy5vcmcvbnMjIgogICB4bWxuczpyZGY9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkvMDIvMjItcmRmLXN5bnRheC1ucyMiCiAgIHhtbG5zOnN2Zz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciCiAgIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIKICAgdmlld0JveD0iMCAwIDIwMi40MzI1IDIwMi4zNDEyNSIKICAgaGVpZ2h0PSIyMDIuMzQxMjUiCiAgIHdpZHRoPSIyMDIuNDMyNSIKICAgeG1sOnNwYWNlPSJwcmVzZXJ2ZSIKICAgdmVyc2lvbj0iMS4xIgogICBpZD0ic3ZnMiI+PG1ldGFkYXRhCiAgICAgaWQ9Im1ldGFkYXRhOCI+PHJkZjpSREY+PGNjOldvcmsKICAgICAgICAgcmRmOmFib3V0PSIiPjxkYzpmb3JtYXQ+aW1hZ2Uvc3ZnK3htbDwvZGM6Zm9ybWF0PjxkYzp0eXBlCiAgICAgICAgICAgcmRmOnJlc291cmNlPSJodHRwOi8vcHVybC5vcmcvZGMvZGNtaXR5cGUvU3RpbGxJbWFnZSIgLz48L2NjOldvcms+PC9yZGY6UkRGPjwvbWV0YWRhdGE+PGRlZnMKICAgICBpZD0iZGVmczYiPjxjbGlwUGF0aAogICAgICAgaWQ9ImNsaXBQYXRoMTYiCiAgICAgICBjbGlwUGF0aFVuaXRzPSJ1c2VyU3BhY2VPblVzZSI+PHBhdGgKICAgICAgICAgaWQ9InBhdGgxOCIKICAgICAgICAgZD0ibSAwLDE2MS44NzMgMTYxLjk0NiwwIEwgMTYxLjk0NiwwIDAsMCAwLDE2MS44NzMgWiIgLz48L2NsaXBQYXRoPjwvZGVmcz48ZwogICAgIHRyYW5zZm9ybT0ibWF0cml4KDEuMjUsMCwwLC0xLjI1LDAsMjAyLjM0MTI1KSIKICAgICBpZD0iZzEwIj48ZwogICAgICAgaWQ9ImcxMiI+PGcKICAgICAgICAgY2xpcC1wYXRoPSJ1cmwoI2NsaXBQYXRoMTYpIgogICAgICAgICBpZD0iZzE0Ij48ZwogICAgICAgICAgIHRyYW5zZm9ybT0idHJhbnNsYXRlKDUyLjQ0NzcsODguMTI2OCkiCiAgICAgICAgICAgaWQ9ImcyMCI+PHBhdGgKICAgICAgICAgICAgIGlkPSJwYXRoMjIiCiAgICAgICAgICAgICBzdHlsZT0iZmlsbDojMDAwMDAwO2ZpbGwtb3BhY2l0eToxO2ZpbGwtcnVsZTpub256ZXJvO3N0cm9rZTpub25lIgogICAgICAgICAgICAgZD0ibSAwLDAgYyAwLDcuNiA2LjE3OSwxMy43NzkgMTMuNzcsMTMuNzc5IDcuNiwwIDEzLjc3OSwtNi4xNzkgMTMuNzc5LC0xMy43NzkgMCwtMi43NjkgLTIuMjM4LC01LjAwNyAtNC45OTgsLTUuMDA3IC0yLjc2MSwwIC00Ljk5OSwyLjIzOCAtNC45OTksNS4wMDcgMCwyLjA3OCAtMS42OTUsMy43NjUgLTMuNzgyLDMuNzY1IEMgMTEuNjkzLDMuNzY1IDkuOTk3LDIuMDc4IDkuOTk3LDAgOS45OTcsLTIuNzY5IDcuNzYsLTUuMDA3IDQuOTk5LC01LjAwNyAyLjIzOCwtNS4wMDcgMCwtMi43NjkgMCwwIG0gNTcuMDUsLTIzLjE1MyBjIDAsLTIuNzcxIC0yLjIzNywtNS4wMDcgLTQuOTk4LC01LjAwNyBsIC00Ni4zNzgsMCBjIC0yLjc2MSwwIC00Ljk5OSwyLjIzNiAtNC45OTksNS4wMDcgMCwyLjc2OSAyLjIzOCw1LjAwNyA0Ljk5OSw1LjAwNyBsIDQ2LjM3OCwwIGMgMi43NjEsMCA0Ljk5OCwtMi4yMzggNC45OTgsLTUuMDA3IE0gMzUuMzc5LC0yLjgwNSBjIC0xLjU0NSwyLjI5MSAtMC45NDEsNS4zOTggMS4zNSw2Ljk0MyBsIDExLjU5NCw3LjgzIGMgMi4yNzMsMS41OCA1LjM5OCwwLjk0MSA2Ljk0MywtMS4zMzIgMS41NDUsLTIuMjkgMC45NDEsLTUuMzk4IC0xLjM1LC02Ljk0MyBsIC0xMS41OTQsLTcuODMgYyAtMC44NTIsLTAuNTg2IC0xLjgyOSwtMC44NyAtMi43ODgsLTAuODcgLTEuNjA3LDAgLTMuMTg3LDAuNzgxIC00LjE1NSwyLjIwMiBtIDMxLjc0OCwtMzAuNzg2IGMgMCwtMC45NDUgLTAuMzc2LC0xLjg1MiAtMS4wNDUsLTIuNTIyIGwgLTguNjE3LC04LjYxNyBjIC0wLjY2OSwtMC42NjggLTEuNTc2LC0xLjA0NSAtMi41MjMsLTEuMDQ1IGwgLTUyLjgzMywwIGMgLTAuOTQ3LDAgLTEuODU0LDAuMzc3IC0yLjUyMywxLjA0NSBsIC04LjYxNyw4LjYxNyBjIC0wLjY2OSwwLjY3IC0xLjA0NSwxLjU3NyAtMS4wNDUsMi41MjIgbCAwLDUyLjc5OSBjIDAsMC45NDcgMC4zNzYsMS44NTQgMS4wNDUsMi41MjIgbCA4LjYxNyw4LjYxOSBjIDAuNjY5LDAuNjY4IDEuNTc2LDEuMDQ0IDIuNTIzLDEuMDQ0IGwgNTIuODMzLDAgYyAwLjk0NywwIDEuODU0LC0wLjM3NiAyLjUyMywtMS4wNDQgbCA4LjYxNywtOC42MTkgYyAwLjY2OSwtMC42NjggMS4wNDUsLTEuNTc1IDEuMDQ1LC0yLjUyMiBsIDAsLTUyLjc5OSB6IG0gNy4zMzQsNjEuMDg2IC0xMS4yNSwxMS4yNSBjIC0xLjcwNSwxLjcwNSAtNC4wMTgsMi42NjMgLTYuNDI4LDIuNjYzIGwgLTU2LjUyMywwIGMgLTIuNDEyLDAgLTQuNzI1LC0wLjk1OSAtNi40MywtMi42NjUgTCAtMTcuNDEyLDI3LjQ5NCBjIC0xLjcwNCwtMS43MDUgLTIuNjYxLC00LjAxNiAtMi42NjEsLTYuNDI3IGwgMCwtNTYuNTE1IGMgMCwtMi40MTEgMC45NTgsLTQuNzI1IDIuNjYzLC02LjQyOCBsIDExLjI1LC0xMS4yNSBjIDEuNzA1LC0xLjcwNSA0LjAxNywtMi42NjIgNi40MjgsLTIuNjYyIGwgNTYuNTE1LDAgYyAyLjQxLDAgNC43MjMsMC45NTcgNi40MjgsMi42NjIgbCAxMS4yNSwxMS4yNSBjIDEuNzA1LDEuNzAzIDIuNjYzLDQuMDE3IDIuNjYzLDYuNDI4IGwgMCw1Ni41MTQgYyAwLDIuNDEyIC0wLjk1OCw0LjcyNCAtMi42NjMsNi40MjkiIC8+PC9nPjwvZz48L2c+PC9nPjwvc3ZnPg==';

let _: any = null;

export default function RobotRenderer(eventBus: any, bpmnRenderer: any): any {
  BaseRenderer.call(_, eventBus, 1500);
  _.canRender = function (element: any) {
    return is(element, 'bpmn:ServiceTask') && element.id.match(/robot/i);
  };
  _.drawShape = function (parent: any, element: any) {
    bpmnRenderer.handlers['bpmn:Task'](parent, element);

    const gfx: any = svgCreate('image', {
      x: -1,
      y: -1,
      width: 32, // element.width,
      height: 32, //  element.height,
      href: Robot,
    });

    svgAppend(parent, gfx);

    return gfx;
  };
}

_ = RobotRenderer;

inherits(RobotRenderer, BaseRenderer);

RobotRenderer.$inject = ['eventBus', 'bpmnRenderer'];
